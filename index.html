<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Little Pinky's Magical Adventure â€“ A 3D Pixar-Style Short Story for Kids</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.js"></script>
    <style>
      body { margin: 0; padding: 0; overflow: hidden; background: #87CEEB; }
      canvas { display: block; }
    </style>
  </head>
  <body>
    <script>
      let globalTime = 0;
      let particles = [];
      let storyIndex = 0;
      let friends = [
        {color: [100, 150, 255], pos: {x: -1000, z: 0}, active: false, jumpPhase: 0},
        {color: [100, 220, 100], pos: {x: 1000, z: 0}, active: false, jumpPhase: PI}
      ];

      const story = [
        "Little Pinky's Magical Adventure âœ¨",
        "",
        "Once upon a time, in a bright colorful world...",
        "there was a cute little creature named Pinky!",
        "Pinky loved to bounce and explore everywhere. ðŸ¾",
        "One sunny day, Pinky went on a big adventure...",
        "and discovered a glowing magical flower! ðŸŒ¸",
        "'Wow!' said Pinky. 'This flower is so beautiful!'",
        "Pinky made a special wish...",
        "'I wish for friends to play with forever!'",
        "Poof! Magical sparkles filled the sky... âœ¨âœ¨âœ¨",
        "And suddenly, two new friends appeared!",
        "Meet Bluey and Greeny! ðŸ‘‹",
        "They all hugged and laughed together. ðŸ’•",
        "Now Pinky and friends dance and play happily...",
        "forever and ever! ðŸŽ‰",
        "The End! Thank you for watching! ðŸŒˆ"
      ];

      function setup() {
        createCanvas(windowWidth, windowHeight, WEBGL);
      }

      function draw() {
        globalTime++;
        let seconds = globalTime / 60;

        background(135, 206, 235);

        // Professional lighting for Pixar-like shine
        ambientLight(100);
        directionalLight(255, 255, 220, 0.4, -0.8, -0.4);
        pointLight(255, 220, 100, 600, -800, 800); // Sun-like

        // Cinematic orbiting camera
        let camRadius = 1200 + sin(globalTime * 0.02) * 200;
        let camAngle = globalTime * 0.004;
        let camY = -300 + sin(globalTime * 0.01) * 100;
        camera(
          sin(camAngle) * camRadius,
          camY,
          cos(camAngle) * camRadius,
          0, 0, 0,
          0, 1, 0
        );

        // Large green ground
        push();
        translate(0, 200, 0);
        rotateX(HALF_PI);
        fill(40, 160, 60);
        plane(5000, 5000);
        pop();

        // Update story (new line every ~7 seconds)
        storyIndex = floor(seconds / 7);
        if (storyIndex >= story.length) storyIndex = story.length - 1;

        // Scene-based character movement
        let charX = 0;
        let charZ = 0;
        let charJump = abs(sin(globalTime * 0.15)) * 50;
        let armAngle = sin(globalTime * 0.25) * 0.6;

        if (seconds < 14) {
          // Gentle intro bounce
          charJump = abs(sin(globalTime * 0.1)) * 40;
        } else if (seconds < 35) {
          // Exploring â€“ circling movement
          charX = sin(seconds * 0.3) * 500;
          charZ = cos(seconds * 0.3) * 400;
          charJump = abs(sin(globalTime * 0.18)) * 80;
          armAngle = sin(globalTime * 0.3) * 0.9;
        } else if (seconds < 55) {
          // Approaching flower
          charX = lerp(charX, 0, 0.08);
          charZ = lerp(charZ, -300, 0.08);
          charJump = abs(sin(globalTime * 0.22)) * 100;
          // Sparkles around flower
          if (globalTime % 12 === 0) {
            for (let i = 0; i < 15; i++) {
              particles.push({
                x: random(-100, 100),
                y: random(-300, -100),
                z: random(-400, -200),
                vy: random(-4, -1),
                life: 120,
                size: random(8, 20)
              });
            }
          }
        } else {
          // Happy dance party!
          charX = sin(globalTime * 0.12) * 250;
          charZ = cos(globalTime * 0.1) * 200;
          charJump = abs(sin(globalTime * 0.25)) * 120;
          armAngle = sin(globalTime * 0.4) * 1.4;

          // Activate friends after wish
          if (seconds > 60) {
            friends[0].active = true;
            friends[1].active = true;
          }

          // Confetti rain
          if (globalTime % 8 === 0) {
            particles.push({
              x: random(-800, 800),
              y: -600,
              z: random(-600, 600),
              vy: random(4, 10),
              spin: random(-0.15, 0.15),
              color: [random(255), random(255), random(255)],
              life: 200
            });
          }
        }

        // Update friends
        friends.forEach(f => {
          if (f.active) {
            f.pos.x = lerp(f.pos.x, (f === friends[0] ? -250 : 250), 0.06);
            f.pos.z = sin(globalTime * 0.2 + f.jumpPhase) * 150;
          }
        });

        // Draw magical flower (appears after exploring)
        if (seconds > 20) {
          drawFlower(0, 50, -300);
        }

        // Draw characters
        drawCharacter(charX, 100 - charJump, charZ, [255, 105, 180], armAngle);

        friends.forEach(f => {
          if (f.active) {
            let fJump = abs(sin(globalTime * 0.22 + f.jumpPhase)) * 100;
            let fArm = sin(globalTime * 0.35 + f.jumpPhase) * 1.2;
            drawCharacter(f.pos.x, 100 - fJump, f.pos.z, f.color, fArm);
          }
        });

        // Particles (sparkles & confetti)
        for (let i = particles.length - 1; i >= 0; i--) {
          let p = particles[i];
          p.y += p.vy;
          p.life--;
          if (p.life <= 0) {
            particles.splice(i, 1);
            continue;
          }
          push();
          translate(p.x, p.y, p.z);
          if (p.color) {
            // Confetti
            fill(p.color);
            rotate(globalTime * p.spin);
            box(20);
          } else {
            // Sparkles
            fill(255, 255, 200, p.life * 2);
            sphere(p.size);
          }
          pop();
        }

        // 2D story narration overlay (professional clean text)
        push();
        resetMatrix();
        ortho(-width / 2, width / 2, height / 2, -height / 2, -5000, 5000);
        textAlign(CENTER, CENTER);
        textSize(42);
        fill(255, 255, 255, 230);
        noStroke();
        let currentText = story[min(storyIndex, story.length - 1)];
        text(currentText, 0, height / 2 - 120);

        if (storyIndex >= story.length - 1) {
          textSize(70);
          fill(255, 255, 0);
          text("Happily Ever After! ðŸŽ‰ðŸ’•", 0, 0);
        }
        pop();
      }

      function drawCharacter(x, y, z, col, armA) {
        push();
        translate(x, y, z);

        // Shiny Pixar-like material
        specularMaterial(col[0], col[1], col[2]);
        shininess(80);

        // Body
        sphere(80);

        // Head
        translate(0, -90, 0);
        sphere(70);

        // Big cute eyes
        fill(255);
        push();
        translate(-30, -15, 55);
        sphere(30);
        translate(0, 0, 15);
        fill(0);
        sphere(15);
        translate(-8, -8, 5);
        fill(255);
        sphere(8); // Sparkle
        pop();

        push();
        translate(30, -15, 55);
        sphere(30);
        translate(0, 0, 15);
        fill(0);
        sphere(15);
        translate(8, -8, 5);
        fill(255);
        sphere(8);
        pop();

        // Cheeks
        fill(255, 150, 180, 180);
        push();
        translate(-45, 10, 45);
        sphere(25);
        pop();
        push();
        translate(45, 10, 45);
        sphere(25);
        pop();

        // Arms waving
        push();
        translate(0, 80, 0); // Back to body center
        rotateZ(armA);
        translate(-100, 0, 0);
        sphere(40);
        pop();
        push();
        translate(0, 80, 0);
        rotateZ(-armA);
        translate(100, 0, 0);
        sphere(40);
        pop();

        // Legs
        push();
        translate(-35, 90, 0);
        sphere(40);
        pop();
        push();
        translate(35, 90, 0);
        sphere(40);
        pop();

        pop();
      }

      function drawFlower(x, y, z) {
        push();
        translate(x, y, z);

        // Stem
        fill(0, 180, 0);
        cylinder(25, 300);

        // Flower head
        translate(0, -150, 0);
        specularMaterial(255, 215, 0);
        shininess(100);
        sphere(60);

        // Colorful petals
        for (let i = 0; i < 10; i++) {
          push();
          rotateY(i * TWO_PI / 10);
          translate(60, 0, 0);
          rotateX(HALF_PI * 0.6);
          fill(lerpColor(color(255, 100, 255), color(255, 200, 0), i / 10));
          ellipsoid(40, 100, 40);
          pop();
        }

        // Extra glow when magic happens
        if (globalTime / 60 > 50) {
          specularMaterial(255, 255, 255);
          shininess(200);
          sphere(80);
        }

        pop();
      }

      function windowResized() {
        resizeCanvas(windowWidth, windowHeight);
      }
    </script>
  </body>
</html>